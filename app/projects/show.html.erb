<script>
  function initPano() {
    // 1. Localiza o elemento
    const panoDiv = document.getElementById('panorama');
    
    // 2. Só executa se o elemento existir e o Pannellum estiver carregado no navegador
    if (panoDiv && typeof pannellum !== 'undefined') {
      // Limpa instâncias anteriores para evitar conflitos de navegação
      panoDiv.innerHTML = ""; 
      
      try {
        pannellum.viewer('panorama', {
          "type": "equirectangular",
          "panorama": "<%= j url_for(@project.panorama_image) %>",
          "autoLoad": true,
          "autoRotate": -1,
          "showControls": true,
          "backgroundColor": [0, 0, 0]
        });
        console.log("Pannellum inicializado com sucesso.");
      } catch (e) {
        console.error("Erro ao carregar o panorama:", e);
      } 
    } else {
      console.warn("Elemento #panorama ou biblioteca Pannellum não encontrados.");
    }
  }

  // Escuta os eventos do Rails para carregar em qualquer situação
  document.addEventListener("turbo:load", initPano);
  document.addEventListener("DOMContentLoaded", initPano);
  
  // Execução imediata como última garantia
  setTimeout(initPano, 500); 
</script>