<script>
  function initPano() {
    // 1. Localiza o elemento
    const panoDiv = document.getElementById('panorama');
    
    // 2. Só executa se o elemento existir e o Pannellum estiver carregado no navegador
    if (panoDiv && typeof pannellum !== 'undefined') {
      // Limpa instâncias anteriores para evitar conflitos de navegação
      panoDiv.innerHTML = ""; 
      
      try {
      pannellum.viewer('panorama', {
  "type": "equirectangular",
  "panorama": "<%= url_for(@project.panorama_image) %>",
  "autoLoad": true,
  "hotSpots": [
    <% @project.hotspots.each do |hs| %>
      {
        "pitch": <%= hs.pitch %>,
        "yaw": <%= hs.yaw %>,
        "type": "info",
        "text": "<%= j hs.title %>: <%= j hs.description %>"
      },
    <% end %>
  ]
});
        console.log("Pannellum inicializado com sucesso.");
      } catch (e) {
        console.error("Erro ao carregar o panorama:", e);
      } 
    } else {
      console.warn("Elemento #panorama ou biblioteca Pannellum não encontrados.");
    }
  }

  // Escuta os eventos do Rails para carregar em qualquer situação
  document.addEventListener("turbo:load", initPano);
  document.addEventListener("DOMContentLoaded", initPano);
  
  // Execução imediata como última garantia
  setTimeout(initPano, 500); 
</script>

<style>

/* Customizando o ícone do Hotspot para o padrão Archway */
.pnlm-hotspot.pnlm-info {
    background-color: rgba(197, 163, 103, 0.8) !important; /* Dourado Archway */
    border: 2px solid white !important;
    border-radius: 50% !important;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(197, 163, 103, 0.5);
    transition: all 0.3s ease;
}

.pnlm-hotspot.pnlm-info:hover {
    background-color: #ffffff !important;
    transform: scale(1.2);
}

/* Tooltip (o balão que abre) */
.pnlm-tooltip span {
    background: rgba(17, 17, 17, 0.95) !important;
    color: #fff !important;
    border: 1px solid rgba(197, 163, 103, 0.3) !important;
    font-family: 'Inter', sans-serif;
    font-size: 11px !important;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 10px 15px !important;
    border-radius: 8px !important;
}
</style>