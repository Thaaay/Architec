<style>
  #panorama {
    width: 100%;
    height: 600px;
    background: #1a1a1a;
    border-radius: 24px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    overflow: hidden;
  }

  /* Personalização dos Hotspots (Pontos Dourados) */
  .pnlm-hotspot.pnlm-info {
    background-color: rgba(197, 163, 103, 0.8) !important; 
    border: 2px solid white !important;
    border-radius: 50% !important;
    cursor: pointer;
    box-shadow: 0 0 15px rgba(197, 163, 103, 0.5);
    transition: all 0.3s ease;
  }

  .pnlm-hotspot.pnlm-info:hover {
    background-color: #ffffff !important;
    transform: scale(1.2);
  }

  /* Balão de texto (Tooltip) */
  .pnlm-tooltip span {
    background: rgba(17, 17, 17, 0.95) !important;
    color: #fff !important;
    border: 1px solid rgba(197, 163, 103, 0.3) !important;
    font-family: 'Inter', sans-serif;
    font-size: 12px !important;
    padding: 10px 15px !important;
    border-radius: 8px !important;
  }
</style>

<div class="min-h-screen bg-[#0a0a0a] text-white py-12 px-4">
  <div class="max-w-6xl mx-auto">
    
    <div class="mb-8 flex justify-between items-end">
      <div>
        <h1 class="text-4xl font-light tracking-widest text-[#c5a367] uppercase mb-2">
          <%= @project.title %>
        </h1>
        <p class="text-gray-400 max-w-2xl"><%= @project.description %></p>
      </div>
      <%= link_to "← Voltar", root_path, class: "text-[#c5a367] hover:text-white transition-colors pb-2" %>
    </div>

    <div id="panorama">
      <% unless @project.panorama_image.attached? %>
        <div class="flex items-center justify-center h-full text-gray-500">
          <p>Nenhuma imagem 360 anexada.</p>
        </div>
      <% end %>
    </div>

    <% if @project.images.attached? %>
      <div class="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
        <% @project.images.each do |image| %>
          <div class="aspect-video rounded-xl overflow-hidden border border-white/10 group">
            <%= image_tag image, class: "w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" %>
          </div>
        <% end %>
      </div>
    <% end %>

  </div>
</div>

<script>
  function initPano() {
    const panoDiv = document.getElementById('panorama');
    
    // Verifica se a div existe e se a biblioteca Pannellum foi carregada
    if (panoDiv && typeof pannellum !== 'undefined') {
      
      <% if @project.panorama_image.attached? %>
        // Limpa o conteúdo interno para evitar bugs de reinicialização do Turbo
        panoDiv.innerHTML = ""; 

        try {
          pannellum.viewer('panorama', {
            "type": "equirectangular",
            "panorama": "<%= @project.panorama_image.attached? ? @project.panorama_image.url : '' %>",,
            "autoLoad": true,
            "autoRotate": -1,
            "hotSpots": [
              <% @project.hotspots.each do |hs| %>
                {
                  "pitch": <%= hs.pitch %>,
                  "yaw": <%= hs.yaw %>,
                  "type": "info",
                  "text": "<%= j hs.title %>: <%= j hs.description %>"
                },
              <% end %>
            ]
          });
        } catch (e) {
          console.error("Erro ao carregar Pannellum:", e);
        }
      <% end %>
    }
  }

  // Compatibilidade com Turbo Rails 7
  document.addEventListener("turbo:load", initPano);
  document.addEventListener("DOMContentLoaded", initPano);
</script>